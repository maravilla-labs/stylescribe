<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{title}}</title>
        {{#if branding.favicon}}
        <link rel="icon" href="/static/{{branding.favicon}}">
        {{/if}}
        <link rel="stylesheet" href="{{basePath}}css/stylescribe.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
        {{#if externalCssIncludes}}
        <style>
            {{#each externalCssIncludes}}
            @import url('{{{this}}}');
            {{/each}}
        </style>
        {{/if}}
        {{#each headIncludes}}
        <link rel="stylesheet" href="/{{this}}">
        {{/each}}
        <style>
            :root {
                {{#each flatTokens}}
                {{this.cssVar}}: {{this.value}};
                {{/each}}
            }

            .token-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .color-swatch {
                height: 80px;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                font-family: monospace;
                color: #fff;
                text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            }

            .token-info {
                padding: 12px;
            }

            .token-name {
                font-family: monospace;
                font-size: 13px;
                font-weight: 600;
                color: #333;
                word-break: break-all;
            }

            .token-value {
                font-family: monospace;
                font-size: 12px;
                color: #666;
                margin-top: 4px;
            }

            .token-description {
                font-size: 12px;
                color: #888;
                margin-top: 8px;
            }

            .spacing-visual {
                width: 120px;
                height: 20px;
                background: #e5e7eb;
                border-radius: 4px;
                overflow: hidden;
                flex-shrink: 0;
            }

            .spacing-visual-bar {
                height: 100%;
                background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                border-radius: 4px;
                min-width: 4px;
                max-width: 100%;
            }

            .radius-demo {
                width: 60px;
                height: 60px;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }

            .shadow-demo {
                width: 100px;
                height: 60px;
                background: #fff;
                border-radius: 8px;
            }

            .typography-demo {
                padding: 1rem;
                background: #f8f9fa;
                border-radius: 8px;
                margin-bottom: 1rem;
            }

            .font-sample {
                margin-bottom: 0.5rem;
            }

            .category-icon {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 8px;
                font-size: 16px;
            }
        </style>
        <script src="{{basePath}}js/theme-init.js"></script>
    </head>
    <body hx-boost="true"
          hx-target="#stylescribe-wrapper"
          hx-select="#stylescribe-wrapper"
          hx-swap="outerHTML show:window:top"
          class="min-h-screen bg-gray-50 dark:bg-slate-900"
          data-basepath="{{basePath}}"
          data-page-type="tokens-wide">
        <div id="stylescribe-wrapper">
        {{> navigation basePath=basePath branding=branding navigation=navigation groups=groups activeNav=activeNav}}

        <div class="main-content flex">
            <!-- Main Content (no left sidebar) -->
            <main class="flex-1 min-w-0 flex justify-center py-8 px-4 md:px-8">
                <div class="w-full max-w-3xl">
                    <!-- Breadcrumb -->
                    <nav class="breadcrumb mb-6" aria-label="Breadcrumb">
                        {{#each breadcrumb}}
                        {{#if this.href}}
                        <a href="{{this.href}}" class="breadcrumb-link">{{this.label}}</a>
                        <span class="breadcrumb-separator">/</span>
                        {{else}}
                        <span class="text-gray-900 dark:text-white font-medium">{{this.label}}</span>
                        {{/if}}
                        {{/each}}
                    </nav>

                    <article class="bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 p-6 md:p-8 lg:p-10 shadow-sm">
                        <header class="mb-8 pb-6 border-b border-gray-200 dark:border-slate-700">
                            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">{{title}}</h1>
                            {{#if description}}
                            <p class="mt-3 text-lg text-gray-600 dark:text-gray-300">{{description}}</p>
                            {{/if}}
                        </header>

                        {{#if content}}
                        <div class="prose prose-gray dark:prose-invert max-w-none mb-8">
                            {{{content}}}
                        </div>
                        {{/if}}

                    {{#if tokenGroups}}
                    <!-- Dynamic Filter Buttons -->
                    <div class="flex flex-wrap gap-2 mb-8">
                        <input type="text"
                               class="px-4 py-2 border border-gray-200 dark:border-slate-600 rounded-full text-sm w-64 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                               id="tokenSearch"
                               placeholder="Search tokens...">
                        <button class="filter-btn px-4 py-2 border border-gray-200 dark:border-slate-600 bg-gray-900 text-white rounded-full text-sm cursor-pointer transition-colors" data-filter="all">All</button>
                        {{#each tokenGroups}}
                        <button class="filter-btn px-4 py-2 border border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white rounded-full text-sm cursor-pointer hover:bg-gray-900 dark:hover:bg-gray-700 hover:text-white hover:border-gray-900 dark:hover:border-gray-700 transition-colors" data-filter="{{this.name}}">{{this.displayName}}</button>
                        {{/each}}
                    </div>

                    <!-- Dynamic Category Sections -->
                    {{#each tokenGroups}}
                    <section class="category-section mb-12" data-category="{{this.name}}" id="category-{{this.name}}">
                        <div class="flex items-center gap-3 mb-6 pb-2 border-b-2 border-gray-200 dark:border-slate-700">
                            <span class="category-icon" style="background: {{categoryGradient this.name}};">{{categoryIcon this.name}}</span>
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">{{this.displayName}}</h2>
                        </div>

                        {{#if (eq this.renderer "color")}}
                            {{> token-color tokens=this.tokens}}
                        {{else if (eq this.renderer "border")}}
                            {{> token-border tokens=this.tokens}}
                        {{else if (eq this.renderer "dimension")}}
                            {{> token-dimension tokens=this.tokens}}
                        {{else if (eq this.renderer "shadow")}}
                            {{> token-shadow tokens=this.tokens}}
                        {{else if (eq this.renderer "typography")}}
                            {{> token-typography tokens=this.tokens}}
                        {{else if (eq this.renderer "animation")}}
                            {{> token-animation tokens=this.tokens}}
                        {{else if (eq this.renderer "mixed")}}
                            {{> token-mixed tokens=this.tokens}}
                        {{else if (eq this.renderer "icon")}}
                            {{> token-icon tokens=this.tokens}}
                        {{else if (eq this.renderer "gradient")}}
                            {{> token-gradient tokens=this.tokens}}
                        {{else}}
                            {{> token-generic tokens=this.tokens}}
                        {{/if}}
                    </section>
                    {{/each}}

                        {{else}}
                        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <h3 class="text-xl font-medium mb-2 text-gray-900 dark:text-white">No Design Tokens Found</h3>
                            <p>Add a <code class="bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded text-sm">tokens/design-tokens.json</code> file to your project to see tokens here.</p>
                            <p class="mt-2">Or specify <code class="bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded text-sm">tokensFile</code> in your <code class="bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded text-sm">.stylescriberc.json</code> configuration.</p>
                        </div>
                        {{/if}}
                    </article>
                </div>
            </main>

            <!-- Table of Contents -->
            {{#if tokenGroups}}
            <aside class="hidden xl:block w-56 shrink-0 border-l border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800">
                <nav class="toc-nav sticky top-16 max-h-[calc(100vh-64px)] overflow-y-auto p-4">
                    <h4 class="toc-title">On this page</h4>
                    <ul class="toc-list">
                        {{#each headings}}
                        <li class="toc-item toc-item--h{{this.level}}">
                            <a href="#{{this.slug}}" class="toc-link">{{this.text}}</a>
                        </li>
                        {{/each}}
                        {{#if headings.length}}
                        <li class="toc-divider my-2 border-t border-gray-200"></li>
                        {{/if}}
                        {{#each tokenGroups}}
                        <li class="toc-item toc-item--h2">
                            <a href="#category-{{this.name}}" class="toc-link">{{this.displayName}}</a>
                        </li>
                        {{/each}}
                    </ul>
                </nav>
            </aside>
            {{/if}}
        </div>
        </div>

        <!-- Alpine.js (with defer for proper initialization) -->
        <script defer src="{{basePath}}js/alpine.min.js"></script>
        <!-- htmx for SPA navigation -->
        <script src="{{basePath}}js/htmx.min.js"></script>
        <script src="{{basePath}}js/htmx-init.js"></script>
        <!-- Alpine components -->
        <script src="{{basePath}}js/alpine-components.js"></script>
        <!-- Core functionality -->
        <script src="{{basePath}}js/init-registry.js"></script>
        <script src="{{basePath}}js/page-init.js"></script>
        <script>
            // Global copy function (available via onclick)
            function copyToken(cssVar) {
                var text = 'var(' + cssVar + ')';
                navigator.clipboard.writeText(text).then(function() {
                    var btns = document.querySelectorAll('.copy-btn');
                    btns.forEach(function(btn) {
                        if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(cssVar)) {
                            btn.textContent = 'Copied!';
                            btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
                            setTimeout(function() {
                                btn.textContent = 'Copy';
                                btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                            }, 1500);
                        }
                    });
                });
            }

            // Initialize tokens page on first load
            if (window.stylescribePageInit) {
                window.stylescribePageInit.tokensWide();
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
        <script src="https://unpkg.com/lunr/lunr.js"></script>
        <script src="{{basePath}}js/search.js"></script>
        <script src="{{basePath}}js/navigation.js"></script>
    </body>
</html>
