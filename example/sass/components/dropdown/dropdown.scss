/**
 * @title Dropdown
 * @description Modern dropdown menu with scrollable items featuring icon, title,
 *   description and optional action. Uses CSS subgrid for perfect alignment across
 *   all items. Supports keyboard navigation and accessible focus states.
 * @navtitle Dropdown
 * @group Actions
 * @order 2
 * @verified true
 * @role menu
 * @maintag div
 * @classname dropdown
 * @dependencies button, icon
 * @variations sm, lg, scrollable, top, left
 * @additional_variations open
 * @elements
 * - name: trigger
 *   html: <button class="{{class}} ds-btn ds-btn--outline">Open Menu</button>
 * - name: menu
 *   html: <div class="{{class}}"></div>
 * - name: item
 *   html: <button class="{{class}}"></button>
 * - name: icon
 *   html: <span class="{{class}} ds-icon ds-icon--settings"></span>
 * - name: title
 *   html: <span class="{{class}}">Menu Item</span>
 * - name: text
 *   html: <span class="{{class}}">Description</span>
 * - name: action
 *   html: <span class="{{class}}">âŒ˜K</span>
 * - name: divider
 *   html: <div class="{{class}}"></div>
 * @examples
 * - title: Basic Dropdown
 *   description: Simple dropdown with text items
 *   code: |
 *     <div class="ds-dropdown">
 *       <button class="ds-dropdown__trigger ds-btn ds-btn--outline">
 *         <span>Options</span>
 *         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
 *       </button>
 *       <div class="ds-dropdown__menu">
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__title">Edit</span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__title">Duplicate</span>
 *         </button>
 *         <div class="ds-dropdown__divider"></div>
 *         <button class="ds-dropdown__item ds-dropdown__item--danger">
 *           <span class="ds-dropdown__title">Delete</span>
 *         </button>
 *       </div>
 *     </div>
 * - title: Interactive Playground - Closed State
 *   description: Toggle the checkbox to open/close the dropdown
 *   code: |
 *     <div class="ds-dropdown">
 *       <input type="checkbox" class="ds-dropdown__toggle" id="dropdown-demo-1" aria-hidden="true">
 *       <label for="dropdown-demo-1" class="ds-dropdown__trigger ds-btn ds-btn--primary">
 *         <span>Click to Open</span>
 *         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
 *       </label>
 *       <div class="ds-dropdown__menu">
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Edit Item</span>
 *           <span class="ds-dropdown__text">Modify content</span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Duplicate</span>
 *           <span class="ds-dropdown__text">Create a copy</span>
 *         </button>
 *         <div class="ds-dropdown__divider"></div>
 *         <button class="ds-dropdown__item ds-dropdown__item--danger">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Delete</span>
 *           <span class="ds-dropdown__text">Remove permanently</span>
 *         </button>
 *       </div>
 *     </div>
 * - title: Interactive Playground - Open State
 *   description: Dropdown shown in expanded state
 *   code: |
 *     <div class="ds-dropdown ds-dropdown--open">
 *       <button class="ds-dropdown__trigger ds-btn ds-btn--primary">
 *         <span>Actions Menu</span>
 *         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
 *       </button>
 *       <div class="ds-dropdown__menu">
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Edit Item</span>
 *           <span class="ds-dropdown__text">Modify the content</span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Duplicate</span>
 *           <span class="ds-dropdown__text">Create a copy</span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Share</span>
 *           <span class="ds-dropdown__text">Share with others</span>
 *         </button>
 *         <div class="ds-dropdown__divider"></div>
 *         <button class="ds-dropdown__item ds-dropdown__item--danger">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Delete</span>
 *           <span class="ds-dropdown__text">Remove permanently</span>
 *         </button>
 *       </div>
 *     </div>
 * - title: Scrollable Items with Actions
 *   description: Long list with scroll and action buttons using CSS subgrid
 *   code: |
 *     <div class="ds-dropdown ds-dropdown--open ds-dropdown--scrollable">
 *       <button class="ds-dropdown__trigger ds-btn ds-btn--outline">
 *         <span>User Menu</span>
 *         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
 *       </button>
 *       <div class="ds-dropdown__menu">
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">John Doe</span>
 *           <span class="ds-dropdown__text">john@example.com</span>
 *           <span class="ds-dropdown__action">
 *             <span class="ds-badge ds-badge--success">Online</span>
 *           </span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Jane Smith</span>
 *           <span class="ds-dropdown__text">jane@example.com</span>
 *           <span class="ds-dropdown__action">
 *             <span class="ds-badge ds-badge--secondary">Away</span>
 *           </span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Bob Wilson</span>
 *           <span class="ds-dropdown__text">bob@example.com</span>
 *           <span class="ds-dropdown__action">
 *             <span class="ds-badge">Offline</span>
 *           </span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Alice Johnson</span>
 *           <span class="ds-dropdown__text">alice@example.com</span>
 *           <span class="ds-dropdown__action">
 *             <span class="ds-badge ds-badge--success">Online</span>
 *           </span>
 *         </button>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Charlie Brown</span>
 *           <span class="ds-dropdown__text">charlie@example.com</span>
 *           <span class="ds-dropdown__action">
 *             <span class="ds-badge ds-badge--secondary">Away</span>
 *           </span>
 *         </button>
 *         <div class="ds-dropdown__divider"></div>
 *         <button class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Add User</span>
 *           <span class="ds-dropdown__text">Invite someone new</span>
 *         </button>
 *       </div>
 *     </div>
 * - title: With Actions Column
 *   description: Items featuring action buttons aligned via subgrid
 *   code: |
 *     <div class="ds-dropdown ds-dropdown--open">
 *       <button class="ds-dropdown__trigger ds-btn ds-btn--secondary">
 *         <span>Notifications</span>
 *         <span class="ds-badge ds-badge--danger">3</span>
 *       </button>
 *       <div class="ds-dropdown__menu">
 *         <div class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">New message</span>
 *           <span class="ds-dropdown__text">From Sarah: Hey, are you...</span>
 *           <span class="ds-dropdown__action">
 *             <button class="ds-btn ds-btn--ghost ds-btn--sm">View</button>
 *           </span>
 *         </div>
 *         <div class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Reminder</span>
 *           <span class="ds-dropdown__text">Meeting in 30 minutes</span>
 *           <span class="ds-dropdown__action">
 *             <button class="ds-btn ds-btn--ghost ds-btn--sm">Dismiss</button>
 *           </span>
 *         </div>
 *         <div class="ds-dropdown__item">
 *           <span class="ds-dropdown__icon">
 *             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
 *           </span>
 *           <span class="ds-dropdown__title">Task completed</span>
 *           <span class="ds-dropdown__text">Design review finished</span>
 *           <span class="ds-dropdown__action">
 *             <button class="ds-btn ds-btn--primary ds-btn--sm">Open</button>
 *           </span>
 *         </div>
 *       </div>
 *     </div>
 * - title: Top Position
 *   description: Opens upward above the trigger
 *   code: |
 *     <div style="margin-top: 200px;">
 *       <div class="ds-dropdown ds-dropdown--top ds-dropdown--open">
 *         <button class="ds-dropdown__trigger ds-btn ds-btn--outline">
 *           <span>Opens Up</span>
 *           <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m18 15-6-6-6 6"/></svg>
 *         </button>
 *         <div class="ds-dropdown__menu">
 *           <button class="ds-dropdown__item">
 *             <span class="ds-dropdown__title">Option One</span>
 *           </button>
 *           <button class="ds-dropdown__item">
 *             <span class="ds-dropdown__title">Option Two</span>
 *           </button>
 *           <button class="ds-dropdown__item">
 *             <span class="ds-dropdown__title">Option Three</span>
 *           </button>
 *         </div>
 *       </div>
 *     </div>
 * - title: Left Aligned
 *   description: Menu aligned to the right edge of trigger
 *   code: |
 *     <div style="display: flex; justify-content: flex-end;">
 *       <div class="ds-dropdown ds-dropdown--left ds-dropdown--open">
 *         <button class="ds-dropdown__trigger ds-btn ds-btn--ghost">
 *           <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
 *         </button>
 *         <div class="ds-dropdown__menu">
 *           <button class="ds-dropdown__item">
 *             <span class="ds-dropdown__title">Settings</span>
 *           </button>
 *           <button class="ds-dropdown__item">
 *             <span class="ds-dropdown__title">Help</span>
 *           </button>
 *           <div class="ds-dropdown__divider"></div>
 *           <button class="ds-dropdown__item ds-dropdown__item--danger">
 *             <span class="ds-dropdown__title">Logout</span>
 *           </button>
 *         </div>
 *       </div>
 *     </div>
 */

@layer components {
  .ds-dropdown {
    /* ===== Component Tokens ===== */
    --dropdown-font: var(--font-family-base);
    --dropdown-bg: var(--color-semantic-surface);
    --dropdown-text: var(--color-semantic-text);
    --dropdown-text-muted: var(--color-semantic-text-muted);
    --dropdown-border: var(--color-semantic-border);
    --dropdown-radius: var(--border-radius-lg);
    --dropdown-shadow: var(--shadow-lg);
    --dropdown-min-width: 220px;
    --dropdown-max-height: 320px;
    --dropdown-z-index: var(--z-index-dropdown);

    /* Item tokens */
    --dropdown-item-padding-x: var(--spacing-scale-md);
    --dropdown-item-padding-y: var(--spacing-scale-sm);
    --dropdown-item-gap: var(--spacing-scale-sm);
    --dropdown-item-bg-hover: var(--color-neutral-100);
    --dropdown-item-bg-active: var(--color-neutral-200);

    /* Icon column */
    --dropdown-icon-size: 20px;
    --dropdown-icon-color: var(--color-semantic-text-muted);

    /* Danger state */
    --dropdown-danger-text: var(--color-danger-base);
    --dropdown-danger-bg-hover: var(--color-danger-light);

    /* Animation */
    --dropdown-animation-duration: var(--transition-duration-fast);

    /* ===== Base Styles ===== */
    position: relative;
    display: inline-block;
    font-family: var(--dropdown-font);

    /* Hidden checkbox for toggle (CSS-only interactive) */
    &__toggle {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
      pointer-events: none;
    }

    /* ===== Trigger ===== */
    &__trigger {
      cursor: pointer;
      user-select: none;

      svg:last-child {
        transition: transform var(--dropdown-animation-duration) ease;
      }
    }

    /* ===== Menu Panel ===== */
    &__menu {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: var(--dropdown-z-index);
      min-width: var(--dropdown-min-width);
      margin-top: var(--spacing-scale-xs);
      padding: var(--spacing-scale-xs) 0;

      background: var(--dropdown-bg);
      border: 1px solid var(--dropdown-border);
      border-radius: var(--dropdown-radius);
      box-shadow: var(--dropdown-shadow);

      /* Hidden by default */
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px) scale(0.96);
      transform-origin: top left;

      transition:
        opacity var(--dropdown-animation-duration) ease,
        visibility var(--dropdown-animation-duration) ease,
        transform var(--dropdown-animation-duration) ease;

      /* Subgrid setup for aligned columns */
      display: grid;
      grid-template-columns: auto 1fr auto;
    }

    /* ===== Dropdown Item with Subgrid ===== */
    &__item {
      display: grid;
      grid-template-columns: subgrid;
      grid-column: 1 / -1;
      grid-template-rows: auto auto;
      align-items: center;
      gap: 0 var(--dropdown-item-gap);

      padding: var(--dropdown-item-padding-y) var(--dropdown-item-padding-x);
      margin: 0;

      font-size: var(--font-size-sm);
      color: var(--dropdown-text);
      text-align: left;
      text-decoration: none;

      background: transparent;
      border: none;
      cursor: pointer;

      transition: background var(--dropdown-animation-duration) ease;

      &:hover {
        background: var(--dropdown-item-bg-hover);
      }

      &:active {
        background: var(--dropdown-item-bg-active);
      }

      &:focus-visible {
        outline: 2px solid var(--color-primary-500);
        outline-offset: -2px;
        border-radius: var(--border-radius-sm);
      }

      /* Danger variant */
      &--danger {
        --dropdown-text: var(--dropdown-danger-text);
        --dropdown-icon-color: var(--dropdown-danger-text);

        &:hover {
          background: var(--dropdown-danger-bg-hover);
        }
      }
    }

    /* ===== Icon Column ===== */
    &__icon {
      grid-column: 1;
      grid-row: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--dropdown-icon-size);
      height: var(--dropdown-icon-size);
      color: var(--dropdown-icon-color);
      flex-shrink: 0;

      svg {
        width: 100%;
        height: 100%;
      }
    }

    /* ===== Title Column ===== */
    &__title {
      grid-column: 2;
      grid-row: 1;
      font-weight: var(--font-weight-medium);
      color: var(--dropdown-text);
      white-space: nowrap;
    }

    /* ===== Description Text ===== */
    &__text {
      grid-column: 2;
      grid-row: 2;
      font-size: var(--font-size-xs);
      color: var(--dropdown-text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    /* ===== Action Column ===== */
    &__action {
      grid-column: 3;
      grid-row: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      margin-left: var(--spacing-scale-sm);
    }

    /* ===== Divider ===== */
    &__divider {
      grid-column: 1 / -1;
      height: 1px;
      margin: var(--spacing-scale-xs) 0;
      background: var(--dropdown-border);
    }

    /* ===== Open State - CSS Toggle ===== */
    &__toggle:checked ~ &__menu,
    &__toggle:checked ~ * &__menu,
    &:focus-within > &__menu,
    &--open > &__menu,
    &--open &__menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }

    /* Rotate chevron when open */
    &__toggle:checked ~ &__trigger svg:last-child,
    &:focus-within > &__trigger svg:last-child,
    &--open > &__trigger svg:last-child {
      transform: rotate(180deg);
    }

    /* ===== Scrollable Variation ===== */
    &--scrollable &__menu {
      max-height: var(--dropdown-max-height);
      overflow-y: auto;
      overscroll-behavior: contain;

      /* Custom scrollbar */
      scrollbar-width: thin;
      scrollbar-color: var(--color-neutral-400) transparent;

      &::-webkit-scrollbar {
        width: 6px;
      }

      &::-webkit-scrollbar-track {
        background: transparent;
      }

      &::-webkit-scrollbar-thumb {
        background: var(--color-neutral-400);
        border-radius: 3px;

        &:hover {
          background: var(--color-neutral-500);
        }
      }
    }

    /* ===== Position Variations ===== */
    &--top &__menu {
      top: auto;
      bottom: 100%;
      margin-top: 0;
      margin-bottom: var(--spacing-scale-xs);
      transform-origin: bottom left;
      transform: translateY(8px) scale(0.96);
    }

    &--top.ds-dropdown--open &__menu,
    &--top &__toggle:checked ~ &__menu,
    &--top:focus-within > &__menu {
      transform: translateY(0) scale(1);
    }

    &--left &__menu {
      left: auto;
      right: 0;
      transform-origin: top right;
    }

    &--top.ds-dropdown--left &__menu {
      transform-origin: bottom right;
    }

    /* ===== Size Variations ===== */
    &--sm {
      --dropdown-min-width: 160px;
      --dropdown-item-padding-x: var(--spacing-scale-sm);
      --dropdown-item-padding-y: var(--spacing-scale-xs);
      --dropdown-icon-size: 16px;
    }

    &--lg {
      --dropdown-min-width: 280px;
      --dropdown-item-padding-x: var(--spacing-scale-lg);
      --dropdown-item-padding-y: var(--spacing-scale-md);
      --dropdown-icon-size: 24px;
    }

    /* ===== Simple items without icon ===== */
    &__item:not(:has(&__icon)) {
      grid-template-columns: 1fr auto;

      .ds-dropdown__title {
        grid-column: 1;
      }

      .ds-dropdown__text {
        grid-column: 1;
      }

      .ds-dropdown__action {
        grid-column: 2;
      }
    }
  }
}
